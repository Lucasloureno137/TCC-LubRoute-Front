<div class="estoque-container">
  <div class="page-header">
    <div class="title-section">
      <h1 class="page-title">
        {{ baixoEstoque ? "Produtos em baixo estoque" : "Estoque de produtos" }}
      </h1>
      <app-breadcrumb
        [items]="breadcrumbItems"
        [showContainer]="false"
      ></app-breadcrumb>
    </div>
    <div class="header-buttons" *ngIf="!baixoEstoque">
      <button
        class="btn-primary"
        *ngIf="userManager || isAdmin"
        (click)="onAddEstoque()"
        [disabled]="isLoading"
      >
        <i class="material-icons">add</i>
        Lançar estoque
      </button>
    </div>
  </div>

  <div class="content-card">
    <div class="filters-section">
      <h3 class="filters-title">Filtros</h3>
      <div class="filter-controls">
        <mat-form-field appearance="outline">
          <mat-label>Tipo</mat-label>
          <mat-select
            [(ngModel)]="tipoSelecionado"
            (selectionChange)="onTipoChange($event.value)"
          >
            <mat-option *ngFor="let tipo of tipos" [value]="tipo">
              {{ tipo }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="search-container">
          <div class="search-box">
            <input
              type="text"
              placeholder="Digite algo..."
              [(ngModel)]="searchQuery"
              (keyup.enter)="onSearch()"
              class="search-input"
              [disabled]="isLoading"
            />
            <button
              class="search-btn"
              (click)="onSearch()"
              [disabled]="isLoading"
            >
              <i class="material-icons">search</i>
            </button>
          </div>
        </div>
        <button class="btn-gray" (click)="limparFiltro()">
          <i class="material-icons">filter_alt_off</i>
          Limpar Filtros
        </button>

       
      </div>
       <div class="filter-actions" *ngIf="!baixoEstoque">
          <button
            class="btn-secondary"
            *ngIf="false"
            (click)="onEditEstoque()"
            [disabled]="isLoading"
          >
            <i class="material-icons">edit</i>
            Editar
          </button>
          <button
            class="btn-danger"
            *ngIf="userManager || isAdmin"
            (click)="onDeleteEstoque()"
            [disabled]="isLoading"
          >
            <i class="material-icons">delete</i>
            Excluir
          </button>
        </div>
    </div>

    <div class="table-section">
      <div class="table-container">
        <table class="estoque-table">
          <thead>
            <tr>
              <th>N</th>
              <th>PRODUTO</th>
              <th>REFERÊNCIA</th>
              <th>TIPO</th>
              <th>QUANTIDADE DISPONÍVEL</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of getPaginatedEstoque()"
              (click)="onRowClick(item)"
              [class.selected]="isSelected(item)"
              class="table-row"
            >
              <td>{{ item.id }}</td>
              <td class="produto-nome">{{ item.produtoNome }}</td>
              <td>{{ item.publicId }}</td>
              <td class="tipo">{{ item.tipo }}</td>
              <td class="quantidade">{{ item.quantidadeDisponivel }}</td>
            </tr>
          </tbody>
        </table>

        <div
          class="empty-state"
          *ngIf="getPaginatedEstoque().length === 0 && !isLoading"
        >
          <i class="material-icons">inventory</i>
          <p>Nenhum produto encontrado no estoque</p>
        </div>

        <div class="loading-state" *ngIf="isLoading">
          <div class="loading-spinner"></div>
          <p>Carregando estoque...</p>
        </div>
      </div>

      <div class="pagination-container" *ngIf="totalPages > 1">
        <div class="pagination-info">
          <span>Itens por página</span>
          <select
            [(ngModel)]="itemsPerPage"
            (change)="updatePagination(); currentPage = 1"
          >
            <option value="5">5</option>
            <option value="9">9</option>
            <option value="15">15</option>
            <option value="30">30</option>
          </select>
        </div>

        <div class="pagination-controls">
          <button
            class="pagination-btn"
            (click)="onPageChange(1)"
            [disabled]="currentPage === 1"
          >
            <i class="material-icons">first_page</i>
          </button>

          <button
            class="pagination-btn"
            (click)="onPageChange(currentPage - 1)"
            [disabled]="currentPage === 1"
          >
            <i class="material-icons">chevron_left</i>
          </button>

          <button
            *ngFor="let page of getPageNumbers()"
            class="pagination-number"
            [class.active]="page === currentPage"
            (click)="onPageChange(page)"
          >
            {{ page }}
          </button>

          <button
            class="pagination-btn"
            (click)="onPageChange(currentPage + 1)"
            [disabled]="currentPage === totalPages"
          >
            <i class="material-icons">chevron_right</i>
          </button>

          <button
            class="pagination-btn"
            (click)="onPageChange(totalPages)"
            [disabled]="currentPage === totalPages"
          >
            <i class="material-icons">last_page</i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
